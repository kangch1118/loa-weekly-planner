<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>LOA Weekly Planner</title>

<style>
:root {
  --bg: #0f1117;
  --panel: #1a1d26;
  --card: #242836;
  --accent: #6aa7ff;
  --text: #e6e6e6;
  --sub: #9aa4b2;
  --radius: 16px;
}

* {
  box-sizing: border-box;
  font-family: Pretendard, sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
}

.container {
  display: flex;
  height: 100vh;
  padding: 20px;
  gap: 20px;
}

/* LEFT */
.left {
  width: 320px;
  background: var(--panel);
  border-radius: var(--radius);
  padding: 20px;
  display: flex;
  flex-direction: column;
}

input, button {
  border: none;
  border-radius: 12px;
  padding: 10px;
  margin-bottom: 10px;
}

input {
  background: var(--card);
  color: var(--text);
}

button {
  background: var(--accent);
  font-weight: bold;
  cursor: pointer;
}

.char-list {
  overflow-y: auto;
}

.char-card {
  background: var(--card);
  border-radius: 14px;
  padding: 12px;
  margin-bottom: 10px;
}

.raid {
  font-size: 13px;
  color: var(--sub);
  margin-top: 4px;
  cursor: grab;
}

/* RIGHT */
.right {
  flex: 1;
  background: var(--panel);
  border-radius: var(--radius);
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 12px;
}

.day {
  background: var(--card);
  border-radius: 14px;
  padding: 10px;
  min-height: 120px;
}

.day h3 {
  text-align: center;
  margin: 0 0 8px;
}

.slot {
  background: #181b24;
  border-radius: 10px;
  padding: 6px;
  margin-bottom: 6px;
  font-size: 13px;
}
</style>
</head>

<body>
<div class="container">

  <!-- LEFT -->
  <div class="left">
    <h2>원정대</h2>
    <input id="name" placeholder="캐릭터 이름">
    <input id="level" type="number" placeholder="레벨">
    <button onclick="addCharacter()">추가</button>
    <div class="char-list" id="charList"></div>
  </div>

  <!-- RIGHT -->
  <div class="right" id="calendar"></div>

</div>

<script>
const RAID_RULES = [
  { name: "발탄", min: 1415 },
  { name: "비아키스", min: 1430 },
  { name: "쿠크세이튼", min: 1475 },
  { name: "아브 1-2", min: 1490 },
  { name: "아브 3-4", min: 1520 },
  { name: "카양겔", min: 1540 },
];

const DAYS = ["수","목","금","토","일","월","화"];

let characters = JSON.parse(localStorage.getItem("chars")) || [];
let schedule = JSON.parse(localStorage.getItem("schedule")) || Object.fromEntries(DAYS.map(d => [d,[]]));
let dragData = null;

function save() {
  localStorage.setItem("chars", JSON.stringify(characters));
  localStorage.setItem("schedule", JSON.stringify(schedule));
}

function getRaids(level) {
  return RAID_RULES.filter(r => level >= r.min).slice(-3);
}

function addCharacter() {
  const name = nameInput.value;
  const level = +levelInput.value;
  if (!name || !level) return;

  characters.push({ name, level, raids: getRaids(level) });
  save();
  renderCharacters();
}

function renderCharacters() {
  charList.innerHTML = "";
  characters.forEach(c => {
    const card = document.createElement("div");
    card.className = "char-card";
    card.innerHTML = `<b>${c.name}</b> (${c.level})`;
    c.raids.forEach(r => {
      const raid = document.createElement("div");
      raid.className = "raid";
      raid.textContent = `• ${r.name}`;
      raid.draggable = true;

      raid.ondragstart = () => {
        dragData = { char: c.name, raid: r.name };
      };

      card.appendChild(raid);
    });
    charList.appendChild(card);
  });
}

function renderCalendar() {
  calendar.innerHTML = "";
  DAYS.forEach(d => {
    const day = document.createElement("div");
    day.className = "day";
    day.innerHTML = `<h3>${d}</h3>`;

    day.ondragover = e => e.preventDefault();
    day.ondrop = () => {
      if (!dragData) return;
      schedule[d].push(dragData);
      dragData = null;
      save();
      renderCalendar();
    };

    schedule[d].forEach(s => {
      const slot = document.createElement("div");
      slot.className = "slot";
      slot.textContent = `${s.char} - ${s.raid}`;
      day.appendChild(slot);
    });

    calendar.appendChild(day);
  });
}

renderCharacters();
renderCalendar();
</script>
</body>
</html>
