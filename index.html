<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>LOA Weekly Planner</title>

<style>
:root{
  --bg:#0f1117;--panel:#1a1d26;--card:#242836;
  --accent:#6aa7ff;--danger:#ff6a6a;
  --text:#e6e6e6;--sub:#9aa4b2;--radius:16px;
}
*{box-sizing:border-box;font-family:Pretendard,sans-serif}
body{margin:0;background:var(--bg);color:var(--text)}
.container{display:flex;height:100vh;padding:20px;gap:20px}

/* LEFT */
.left{
  width:360px;background:var(--panel);border-radius:var(--radius);
  padding:20px;display:flex;flex-direction:column
}
input,button{border:none;border-radius:12px;padding:10px;margin-bottom:10px}
input{background:var(--card);color:var(--text)}
button{background:var(--accent);font-weight:bold;cursor:pointer}
.reset{background:var(--danger)}
.share{background:#6affb7;color:#000}
.char-list{overflow-y:auto;margin-top:10px}
.char-card{
  background:var(--card);border-radius:14px;padding:12px;margin-bottom:12px;
  position:relative
}
.delete-char{
  position:absolute;top:8px;right:10px;
  cursor:pointer;color:var(--danger);font-weight:bold
}
.raid{font-size:13px;color:var(--sub);margin-top:6px;cursor:grab}

/* RIGHT */
.right{
  flex:1;background:var(--panel);border-radius:var(--radius);
  padding:20px;display:grid;grid-template-columns:repeat(7,1fr);gap:12px
}
.day{background:var(--card);border-radius:14px;padding:10px;min-height:150px}
.day h3{text-align:center;margin:0 0 8px}
.slot{
  background:#181b24;border-radius:10px;padding:6px;
  margin-bottom:6px;font-size:13px;cursor:pointer
}
.slot:hover{background:#2a2f40}
</style>
</head>

<body>
<div class="container">

  <div class="left">
    <h2>ÏõêÏ†ïÎåÄ</h2>
    <input id="name" placeholder="Ï∫êÎ¶≠ÌÑ∞ Ïù¥Î¶Ñ">
    <input id="level" type="number" placeholder="ÏïÑÏù¥ÌÖú Î†àÎ≤®">
    <button onclick="addCharacter()">Ï∂îÍ∞Ä</button>
    <button class="reset" onclick="resetWeek()">Ï£ºÍ∞Ñ Ï¥àÍ∏∞Ìôî</button>
    <button class="share" onclick="shareSchedule()">Í≥µÏú† ÎßÅÌÅ¨ ÏÉùÏÑ±</button>
    <div class="char-list" id="charList"></div>
  </div>

  <div class="right" id="calendar"></div>

</div>

<script>
const DAYS=["Ïàò","Î™©","Í∏à","ÌÜ†","Ïùº","Ïõî","Ìôî"];
let characters=[];
let schedule=Object.fromEntries(DAYS.map(d=>[d,[]]));
let dragData=null;

/* üî• Î†àÎ≤®Î≥Ñ Î†àÏù¥Îìú Î°úÏßÅ */
function getWeeklyRaids(level){
  if(level>=1640&&level<=1659){
    return[
      "ÏóêÌîΩ Î†àÏù¥Îìú - Î≤†ÌûàÎ™®Ïä§",
      "Ïπ¥Ï†úÎ°úÏä§ ÏÑúÎßâ - ÏóêÌÇ§ÎìúÎÇò ÌïòÎìú",
      "Íµ∞Îã®Ïû• Î†àÏù¥Îìú - Ïπ¥Î©ò ÌïòÎìú"
    ];
  }
  if(level>=1660&&level<=1669){
    return[
      "Ïπ¥Ï†úÎ°úÏä§ 1Îßâ - ÏóêÍ∏∞Î•¥ ÎÖ∏Îßê",
      "Ïπ¥Ï†úÎ°úÏä§ ÏÑúÎßâ - ÏóêÌÇ§ÎìúÎÇò ÌïòÎìú",
      "ÏóêÌîΩ Î†àÏù¥Îìú - Î≤†ÌûàÎ™®Ïä§"
    ];
  }
  if(level>=1670&&level<=1679){
    return[
      "Ïπ¥Ï†úÎ°úÏä§ 1Îßâ - ÏóêÍ∏∞Î•¥ ÎÖ∏Îßê",
      "Ïπ¥Ï†úÎ°úÏä§ ÏÑúÎßâ - ÏóêÌÇ§ÎìúÎÇò ÌïòÎìú",
      "Ïπ¥Ï†úÎ°úÏä§ 2Îßâ - ÏïÑÎ∏åÎ†êÏäàÎìú ÎÖ∏Îßê"
    ];
  }
  if(level>=1680){
    return[
      "Ïπ¥Ï†úÎ°úÏä§ 1Îßâ - ÏóêÍ∏∞Î•¥ ÌïòÎìú",
      "Ïπ¥Ï†úÎ°úÏä§ 2Îßâ - ÏïÑÎ∏åÎ†êÏäàÎìú ÎÖ∏Îßê",
      "Ïπ¥Ï†úÎ°úÏä§ - Î™®Î•¥Îë† ÎÖ∏Îßê"
    ];
  }
  return[];
}

/* Ï†ÄÏû• & Î°úÎìú */
function save(){
  localStorage.setItem("chars",JSON.stringify(characters));
  localStorage.setItem("schedule",JSON.stringify(schedule));
}
function load(){
  characters=JSON.parse(localStorage.getItem("chars"))||[];
  schedule=JSON.parse(localStorage.getItem("schedule"))
    ||Object.fromEntries(DAYS.map(d=>[d,[]]));
}

/* Ï∫êÎ¶≠ÌÑ∞ */
function addCharacter(){
  const name=nameInput.value.trim();
  const level=Number(levelInput.value);
  if(!name||!level){alert("Ïù¥Î¶ÑÍ≥º Î†àÎ≤® ÏûÖÎ†•");return;}
  const raids=getWeeklyRaids(level);
  if(!raids.length){alert("1640 Ïù¥ÏÉÅÎßå ÏßÄÏõê");return;}
  characters.push({name,level,raids});
  nameInput.value="";levelInput.value="";
  save();renderCharacters();
}
function deleteCharacter(name){
  if(!confirm(`${name} ÏÇ≠Ï†úÌï†ÍπåÏöî?`))return;
  characters=characters.filter(c=>c.name!==name);
  DAYS.forEach(d=>{
    schedule[d]=schedule[d].filter(s=>s.char!==name);
  });
  save();renderCharacters();renderCalendar();
}

/* Î†åÎçî */
function renderCharacters(){
  charList.innerHTML="";
  characters.forEach(c=>{
    const card=document.createElement("div");
    card.className="char-card";
    card.innerHTML=`
      <b>${c.name}</b> (${c.level})
      <span class="delete-char" onclick="deleteCharacter('${c.name}')">‚úñ</span>
    `;
    c.raids.forEach(r=>{
      const raid=document.createElement("div");
      raid.className="raid";
      raid.textContent=`‚Ä¢ ${r}`;
      raid.draggable=true;
      raid.ondragstart=()=>dragData={char:c.name,raid:r};
      card.appendChild(raid);
    });
    charList.appendChild(card);
  });
}

function renderCalendar(){
  calendar.innerHTML="";
  DAYS.forEach(d=>{
    const day=document.createElement("div");
    day.className="day";
    day.innerHTML=`<h3>${d}</h3>`;
    day.ondragover=e=>e.preventDefault();
    day.ondrop=()=>{
      if(!dragData)return;
      schedule[d].push(dragData);
      dragData=null;save();renderCalendar();
    };
    schedule[d].forEach((s,i)=>{
      const slot=document.createElement("div");
      slot.className="slot";
      slot.textContent=`${s.char} - ${s.raid}`;
      slot.onclick=()=>{
        if(confirm("Ïù¥ ÏùºÏ†ï ÏÇ≠Ï†úÌï†ÍπåÏöî?")){
          schedule[d].splice(i,1);
          save();renderCalendar();
        }
      };
      day.appendChild(slot);
    });
    calendar.appendChild(day);
  });
}

/* Í∏∞ÌÉÄ */
function resetWeek(){
  if(!confirm("Ïù¥Î≤à Ï£º Ï†ÑÎ∂Ä Ï¥àÍ∏∞Ìôî?"))return;
  schedule=Object.fromEntries(DAYS.map(d=>[d,[]]));
  save();renderCalendar();
}

function shareSchedule(){
  const data=btoa(encodeURIComponent(JSON.stringify({characters,schedule})));
  const url=`${location.origin}${location.pathname}?data=${data}`;
  navigator.clipboard.writeText(url);
  alert("Í≥µÏú† ÎßÅÌÅ¨ Î≥µÏÇ¨ ÏôÑÎ£å!");
}

/* URL Î≥µÏõê */
function loadFromURL(){
  const params=new URLSearchParams(location.search);
  if(!params.has("data"))return;
  const decoded=JSON.parse(
    decodeURIComponent(atob(params.get("data")))
  );
  characters=decoded.characters;
  schedule=decoded.schedule;
  save();
}

/* INIT */
loadFromURL();
load();
renderCharacters();
renderCalendar();
</script>
</body>
</html>
